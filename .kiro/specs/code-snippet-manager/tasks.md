# 实现计划

- [x] 1. 项目初始化和基础架构搭建

  - 创建 .NET 8 Web API 项目结构，配置基础中间件和依赖注入容器
  - 创建 Vue 3 前端项目，配置 Vite、Vue Router、Pinia 和 Axios
  - 配置 MySQL 数据库连接和 Dapper ORM，实现三层架构基础结构
  - 设计和定义所有核心接口，遵循面向接口编程原则
  - _需求: 技术约束_

- [x] 2. 数据库设计和 Dapper 实体模型实现

  - 创建 Dapper POCO 实体类 (User, CodeSnippet, SnippetVersion, Tag, SnippetTag, ClipboardHistory)
  - 实现 IDbConnectionFactory 接口和 MySQL 连接工厂，注册为单例服务
  - 创建数据库表结构 SQL 脚本并初始化数据库
  - _需求: 1.1, 2.1, 3.1, 4.1, 6.1, 7.1_

- [x] 2.1 依赖注入容器配置和接口注册

  - 配置 .NET DI 容器，注册所有接口和实现类的映射关系
  - 设置不同服务的生命周期 (Singleton, Scoped, Transient)
  - 创建服务注册扩展方法，遵循开闭原则便于扩展
  - 验证依赖注入配置的正确性和对象生命周期管理
  - _需求: 技术约束 - 面向接口编程和容器管理_

- [x] 3. 用户认证和权限管理系统

  - 定义 IAuthService 和 IPermissionService 接口，实现面向接口编程
  - 实现 JWT Token 认证机制和中间件，通过 DI 容器注入依赖
  - 创建用户注册、登录、登出 API 端点，使用构造函数注入服务
  - 实现基于角色的权限验证 (Admin, Editor, Viewer)，遵循开闭原则
  - 创建前端认证状态管理和路由守卫
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [x] 4. 代码片段核心功能实现

- [x] 4.1 代码片段数据访问层 (遵循单一职责和接口隔离原则)

  - 实现 ICodeSnippetRepository 接口和 Dapper 基础 CRUD 操作
  - 创建代码片段查询方法，使用 Dapper 支持分页、筛选和排序
  - 实现代码片段与标签的关联查询，使用 Dapper Multi-mapping
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 4.2 代码片段业务逻辑层 (面向接口编程)

  - 定义 ICodeSnippetService 接口，创建 CodeSnippetService 实现类
  - 实现代码片段创建、更新、删除的业务规则，通过构造函数注入仓储接口
  - 添加代码片段访问权限验证逻辑，注入 IPermissionService 接口
  - 在 DI 容器中注册服务接口和实现，配置 Scoped 生命周期
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 4.3 代码片段 API 控制器 (依赖注入和面向对象)

  - 创建 CodeSnippetsController，通过构造函数注入 ICodeSnippetService
  - 实现获取代码片段列表的 API (支持搜索和筛选)，遵循单一职责原则
  - 实现代码片段详情查看、创建、编辑、删除 API，使用面向对象设计
  - 添加 API 输入验证和错误处理，通过 DI 容器管理验证器生命周期
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 5. 版本管理功能实现

- [x] 5.1 版本数据访问和业务逻辑 (遵循开闭原则)

  - 实现 ISnippetVersionRepository 接口和 Dapper 版本历史查询
  - 创建版本创建、比较和恢复的业务逻辑，支持扩展新的版本策略
  - 实现版本自动创建机制 (代码片段更新时)，使用事务确保数据一致性
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 5.2 版本管理 API 端点

  - 实现版本详情查看和版本恢复 API
  - 添加版本比较功能的 API 支持
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6. 标签管理系统实现

- [x] 6.1 标签数据访问和业务逻辑 (遵循里氏替换原则)

  - 实现 ITagRepository 接口和 Dapper 标签 CRUD 操作
  - 创建标签与代码片段关联的业务逻辑，确保子类可替换父类
  - 实现标签自动补全和管理功能，使用 Dapper 优化查询性能
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 6.2 标签管理 API 控制器

  - 创建 TagsController 提供标签管理 API
  - 实现标签列表、创建、更新、删除 API
  - 添加标签使用统计和自动补全 API
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [-] 7. 一键复制和剪贴板历史功能

- [x] 7.1 剪贴板历史数据管理 (遵循迪米特法则)

  - 实现 IClipboardHistoryRepository 接口和 Dapper 历史记录管理
  - 创建剪贴板历史记录的业务逻辑和清理机制，减少类间耦合
  - 实现复制统计和历史记录限制功能，使用 Dapper 批量操作优化性能
  - _需求: 5.1, 5.2, 5.3, 5.4, 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 7.2 复制功能 API 实现

  - 创建代码片段复制记录 API
  - 实现剪贴板历史查询和管理 API
  - 添加复制统计更新的 API 支持
  - _需求: 5.1, 5.2, 5.3, 5.4, 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 8. 前端核心组件开发

- [x] 8.1 布局和导航组件

  - 创建应用主布局组件 (Header, Sidebar, Footer)
  - 实现响应式导航菜单和用户信息显示
  - 创建面包屑导航和页面标题组件
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 8.2 认证相关页面和组件

  - 创建登录页面和登录表单组件
  - 实现用户认证状态管理 (Pinia Store)
  - 创建路由守卫和权限验证逻辑
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [x] 8.3 代码片段列表和搜索组件

  - 创建代码片段卡片组件，显示片段信息
  - 实现搜索和筛选组件 (语言、标签、创建者)
  - 创建分页组件和无限滚动加载
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 9. 代码编辑器和详情页面


- [x] 9.1 代码编辑器组件

  - 集成代码编辑器 (Monaco Editor 或 CodeMirror)
  - 实现语法高亮和代码格式化功能
  - 添加代码编辑器的主题切换和设置
  - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 9.2 代码片段详情和编辑页面

  - 创建代码片段详情查看页面
  - 实现代码片段创建和编辑表单
  - 添加标签选择和管理界面
  - 集成一键复制功能到详情页面
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5, 5.1, 5.2, 5.3, 5.4, 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 10. 版本历史和比较功能前端



- [x] 10.1 版本历史组件



  - 创建版本历史列表组件
  - 实现版本详情查看和恢复功能
  - 添加版本创建时间和变更描述显示
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 10.2 版本比较界面

  - 实现版本差异对比显示组件
  - 创建并排版本比较视图
  - 添加版本选择和比较操作界面
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 11. 剪贴板历史和复制功能前端

- [x] 11.1 一键复制功能实现

  - 实现浏览器剪贴板 API 集成
  - 创建复制按钮组件和复制成功提示
  - 添加复制失败时的降级处理
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [x] 11.2 剪贴板历史页面

  - 创建剪贴板历史列表页面
  - 实现历史记录的查看和重新复制功能
  - 添加历史记录清理和管理功能
  - _需求: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 12. 用户管理和设置功能


- [x] 12.1 用户管理页面 (管理员功能)



  - 创建用户列表和用户详情页面
  - 实现用户角色管理和权限分配界面
  - 添加用户状态管理 (启用/禁用) 功能
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [x] 12.2 个人设置和偏好



  - 创建个人资料编辑页面
  - 实现主题切换和界面偏好设置
  - 添加密码修改和安全设置功能
  - _需求: 1.1, 1.2, 1.3, 1.4_

- [ ] 13. 错误处理和用户体验优化
- [ ] 13.1 全局错误处理

  - 实现前端全局错误拦截和处理
  - 创建用户友好的错误提示组件
  - 添加网络错误和超时处理机制
  - _需求: 所有需求的错误处理_

- [ ] 13.2 加载状态和用户反馈

  - 实现全局加载状态管理
  - 创建骨架屏和加载动画组件
  - 添加操作成功/失败的用户反馈提示
  - _需求: 所有需求的用户体验_

- [ ] 14. 性能优化和缓存策略
- [ ] 14.1 前端性能优化

  - 实现代码分割和路由懒加载
  - 优化大列表渲染 (虚拟滚动)
  - 添加图片懒加载和资源压缩
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 14.2 后端缓存和 Dapper 性能优化

  - 实现 Redis 缓存策略 (可选)，遵循依赖倒置原则
  - 优化 Dapper 查询性能和数据库索引，使用 Multi-mapping 减少查询次数
  - 添加 API 响应缓存机制和 Dapper 连接池管理
  - _需求: 所有需求的性能优化_

- [ ] 15. 安全加固和测试
- [ ] 15.1 安全功能实现

  - 实现 CSRF 防护和 XSS 过滤
  - 添加 API 请求频率限制
  - 强化输入验证和数据清理
  - _需求: 所有需求的安全考虑_

- [ ] 15.2 单元测试和集成测试 (面向接口测试)

  - 编写后端 API 的单元测试，使用 Mock 对象测试接口实现
  - 创建前端组件的单元测试，测试组件的面向对象设计
  - 实现集成测试，验证依赖注入容器的配置和对象生命周期
  - 编写端到端测试覆盖主要用户流程，验证整个系统的面向接口设计
  - _需求: 所有需求的测试验证_

- [ ] 16. 部署配置和文档
- [ ] 16.1 生产环境配置

  - 配置生产环境的数据库连接和环境变量
  - 创建 Docker 容器化配置文件
  - 设置 CI/CD 部署流水线配置
  - _需求: 技术约束和部署需求_

- [ ] 16.2 项目文档和用户手册
  - 编写 API 文档 (Swagger/OpenAPI)
  - 创建用户使用手册和管理员指南
  - 完善代码注释和开发者文档
  - _需求: 所有需求的文档化_
